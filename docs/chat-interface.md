# Maestro聊天界面文档

## 简介

Maestro聊天界面是类似Claude的AI对话页面，提供了友好的用户体验和完整的对话管理功能。用户可以创建、管理多个对话，在界面中与AI助手进行交互。

## 核心功能

### 1. 对话管理
- 创建新对话
- 切换历史对话
- 编辑对话标题
- 删除对话
- 对话自动保存

### 2. 消息交互
- 发送文本消息
- 接收AI回复
- 消息自动滚动
- 支持Enter直接发送，Shift+Enter换行
- 同时保留Ctrl+Enter (Cmd+Enter)快捷发送支持

### 3. 界面布局
- 可折叠侧边栏，提升空间利用率
- 响应式设计，适配移动端和桌面端
- 支持浅色/深色主题
- 统一顶部标题栏，包含应用名称、对话标题和操作按钮
- 左下角固定头像按钮，便于快速打开侧边栏
- 简洁现代的欢迎页设计，根据时间显示不同问候语

## 技术实现

### 状态管理

使用Zustand管理对话和消息状态：

```typescript
// 消息类型
export interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: number;
}

// 对话类型
export interface Conversation {
  id: string;
  title: string;
  messages: Message[];
  createdAt: number;
  updatedAt: number;
}
```

主要状态函数：
- `createConversation`: 创建新对话
- `addMessage`: 添加消息到当前对话
- `setActiveConversation`: 设置活动对话
- `deleteConversation`: 删除对话
- `updateConversationTitle`: 更新对话标题

### 组件结构

```
└── AppLayout                     # 应用主布局（不包含header，纯容器）
    ├── ChatSidebar               # 侧边栏
    │   ├── 新对话按钮
    │   ├── 对话历史列表
    │   └── 用户信息区域
    └── ChatContainer             # 对话容器
        ├── Header                # 统一顶部标题栏
        │   ├── 应用名称（左侧）
        │   ├── ChatHeader        # 对话标题编辑组件（中间）
        │   └── 操作按钮（右侧）
        ├── MessageList           # 消息列表
        │   └── MessageItem       # 单条消息
        └── ChatInput             # 消息输入框
    ├── WelcomeView               # 欢迎页面（首次使用或无活动对话时显示）
```

## 页面交互逻辑

### 1. 欢迎页面流程

当用户首次访问应用或没有活动对话时，会看到欢迎页面：

1. **智能问候**：
   - 系统根据当前时间显示不同的问候语（早上好/下午好/晚上好）
   - 显示用户名称，若无用户名则显示"您"
   - 问候语使用优雅的大字体显示，位于页面上方约1/3处

2. **中央输入框**：
   - 大尺寸输入框，清晰的边界线和微妙的悬浮效果
   - 输入框位于问候语下方，是主要交互元素
   - 支持自动调整高度，最小56px，最大220px
   - 文本大小适中(18px)，提供舒适的输入体验
   - 状态反馈：
     - 默认：半透明边框
     - 悬停：边框颜色加深
     - 聚焦/输入：原色边框轻微高亮
     - 有内容：增加轻微阴影和边框高亮

3. **功能按钮**：
   - 左下角三个工具按钮（附件、联网、工具）
   - 右下角发送按钮，有内容时高亮显示
   - 所有按钮尺寸适中，易于点击

4. **转场动画**：
   - 问候语和输入框使用渐入动画，增强视觉体验
   - 输入框有轻微的上浮动画效果

5. **交互转换**：
   - 用户发送首条消息后，页面自动转换为常规聊天界面
   - 欢迎页输入框与聊天页输入框样式协调一致，保证流畅过渡体验

### 2. 聊天界面流程

用户发送消息后进入聊天界面：

1. **消息列表**：
   - 用户消息和AI回复以交替方式显示
   - 消息自动滚动到最新位置
   - 用户消息右对齐，AI回复左对齐，视觉上易于区分

2. **底部输入框**：
   - 固定在页面底部，提供统一的输入体验
   - 样式与欢迎页输入框协调，但适应底部固定布局
   - 仅上边框和侧边框，底部与页面融合
   - 保留同样的功能按钮

3. **对话标题管理**：
   - 系统自动根据首条用户消息生成对话标题
   - 用户可点击标题进行编辑
   - 编辑时显示保存和取消按钮

4. **侧边栏交互**：
   - 通过左下角用户头像按钮或左侧边缘悬停打开
   - 显示对话历史列表，支持切换、创建和删除对话
   - 点击外部区域或鼠标离开后自动关闭

5. **消息交互流程**：
   - 用户输入消息并发送（按钮或Ctrl+Enter）
   - 显示发送中状态和加载动画
   - 接收AI响应并添加到对话
   - 对话自动保存

### 3. 通用交互机制

1. **响应式布局**：
   - 自适应不同屏幕尺寸，确保移动端和桌面端都有良好体验
   - 输入框和内容区域宽度自动调整

2. **状态反馈**：
   - 所有交互元素有明确的视觉反馈（悬停、点击、加载状态）
   - 使用微妙的过渡动画增强用户体验

3. **键盘支持**：
   - 支持Enter键直接发送消息
   - 支持Shift+Enter插入换行
   - 同时兼容Ctrl+Enter（或Cmd+Enter）快捷发送

4. **主题支持**：
   - 完整支持亮色/暗色主题切换
   - 所有元素颜色使用变量，确保主题切换一致性

## 使用说明

### 开始新对话
1. 在欢迎页面直接输入并发送消息
2. 或点击侧边栏"新对话"按钮

### 管理对话
1. 选择：点击侧边栏对话列表中的对话切换
2. 编辑标题：点击顶部标题栏中的对话标题进行编辑
3. 删除：在对话列表中悬停时点击右侧出现的删除按钮

### 发送消息
1. 在底部输入框输入文本
2. 点击发送按钮或直接按Enter键发送
3. 如需在消息中添加换行，使用Shift+Enter

## 后续改进

1. **集成实际AI服务**
   - 替换模拟响应为实际API调用
   - 添加流式响应支持

2. **增强功能**
   - 消息引用和编辑
   - 文件和图片上传
   - 多模态交互（语音、图像）
   - 代码高亮和格式化

3. **性能优化**
   - 长对话的虚拟滚动
   - 消息的懒加载
   - 状态缓存优化

4. **安全增强**
   - 敏感信息过滤
   - 内容安全提示
   - 用户权限控制 