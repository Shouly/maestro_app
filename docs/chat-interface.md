# Maestro聊天界面文档

## 简介

Maestro聊天界面是类似Claude的AI对话页面，提供了友好的用户体验和完整的对话管理功能。用户可以创建、管理多个对话，在界面中与AI助手进行交互。

## 核心功能

### 1. 对话管理
- 创建新对话
- 切换历史对话
- 编辑对话标题
- 删除对话
- 对话自动保存

### 2. 消息交互
- 发送文本消息
- 接收AI回复
- 消息自动滚动
- 支持Ctrl+Enter快捷发送

### 3. 界面布局
- 可折叠侧边栏，提升空间利用率
- 响应式设计，适配移动端和桌面端
- 支持浅色/深色主题
- 统一顶部标题栏，包含应用名称、对话标题和操作按钮
- 左下角固定头像按钮，便于快速打开侧边栏

## 技术实现

### 状态管理

使用Zustand管理对话和消息状态：

```typescript
// 消息类型
export interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: number;
}

// 对话类型
export interface Conversation {
  id: string;
  title: string;
  messages: Message[];
  createdAt: number;
  updatedAt: number;
}
```

主要状态函数：
- `createConversation`: 创建新对话
- `addMessage`: 添加消息到当前对话
- `setActiveConversation`: 设置活动对话
- `deleteConversation`: 删除对话
- `updateConversationTitle`: 更新对话标题

### 组件结构

```
└── AppLayout                     # 应用主布局（不包含header，纯容器）
    ├── ChatSidebar               # 侧边栏
    │   ├── 新对话按钮
    │   ├── 对话历史列表
    │   └── 用户信息区域
    └── ChatContainer             # 对话容器
        ├── Header                # 统一顶部标题栏
        │   ├── 应用名称（左侧）
        │   ├── ChatHeader        # 对话标题编辑组件（中间）
        │   └── 操作按钮（右侧）
        ├── MessageList           # 消息列表
        │   └── MessageItem       # 单条消息
        └── ChatInput             # 消息输入框
```

## 使用说明

### 开始新对话
1. 点击侧边栏"新对话"按钮
2. 或直接在输入框输入并发送消息（如无活动对话会自动创建）

### 管理对话
1. 选择：点击侧边栏对话列表中的对话切换
2. 编辑标题：点击顶部标题栏中的对话标题进行编辑
3. 删除：在对话列表中悬停时点击右侧出现的删除按钮

### 发送消息
1. 在底部输入框输入文本
2. 点击发送按钮或使用Ctrl+Enter (Cmd+Enter) 快捷键发送

## 实现细节

### 侧边栏设计

侧边栏采用高性能动画效果：
- 使用spring动画替代之前的缓动动画，减少卡顿感
- 添加左下角固定用户头像按钮，点击即可打开侧边栏
- 移除了鼠标悬停触发逻辑，避免误触和延迟问题
- 对话列表项使用组合式设计，分离点击区域和删除按钮

对话删除按钮优化：
- 悬停时才显示删除按钮，保持界面整洁
- 使用透明度过渡效果，提升视觉体验
- 添加hover视觉反馈，更直观的操作引导

### 标题栏设计

采用Claude风格的标题栏布局：
- 左侧：显示应用名称"Maestro"
- 中间：对话标题（可点击编辑）
- 右侧：操作按钮区域（分享、收藏、更多选项）

标题编辑功能：
- 点击标题或编辑图标进入编辑模式
- 编辑时显示保存和取消按钮
- 支持按Enter保存或Esc取消编辑
- 标题边框圆角设计，悬停时背景色变化提供视觉反馈

### 自适应布局

侧边栏根据屏幕尺寸自动调整：
- 桌面端：可展开/折叠的固定侧边栏
- 移动端：可滑出的浮动侧边栏，点击主内容区域自动隐藏

### 消息处理流程

1. 用户输入消息
2. 消息添加到状态管理
3. 向AI服务发送请求（当前为模拟）
4. 接收响应并添加到对话
5. 自动滚动到最新消息

### 用户友好功能

- 输入框自动调整高度
- 消息时间戳显示
- 加载状态指示
- 空状态引导提示
- 对话标题自动生成（基于首条消息）

## 后续改进

1. **集成实际AI服务**
   - 替换模拟响应为实际API调用
   - 添加流式响应支持

2. **增强功能**
   - 消息引用和编辑
   - 文件和图片上传
   - 多模态交互（语音、图像）
   - 代码高亮和格式化

3. **性能优化**
   - 长对话的虚拟滚动
   - 消息的懒加载
   - 状态缓存优化

4. **安全增强**
   - 敏感信息过滤
   - 内容安全提示
   - 用户权限控制 